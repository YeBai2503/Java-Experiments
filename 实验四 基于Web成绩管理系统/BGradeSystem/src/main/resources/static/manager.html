<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>åŒ—æ¸¯å¤§å­¦ | æ•™åŠ¡ç«¯</title>
  <link rel="icon" type="image/jpg" href="video/logo.png" sizes="32x32">
  <link rel="stylesheet" href="css/normal.css">
</head>
<body>
<video autoplay muted loop>
  <source src="video/Waves.mp4" type="video/mp4">  <!-- æ›¿æ¢ä¸ºæ‚¨çš„ MP4 æ–‡ä»¶è·¯å¾„ -->
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
</video>
<div class="container">
  <h1 style="text-align: center;">åŒ—æ¸¯å¤§å­¦æˆç»©ç®¡ç†ç³»ç»Ÿ----æ•™åŠ¡ç«¯</h1>

  <h1 style="text-align: center;">æ¬¢è¿ç”¨æˆ· <<span id="userName"></span>> !</h1>


  <div style="display: flex; flex-wrap: wrap; justify-content: center;">
    <button onclick="window.location.href='sumData.html';" class="blue-button" style="margin: 10px;">
      æˆç»©åˆ†æ•°æ®µç»Ÿè®¡åˆ†å¸ƒ
    </button>
    <button onclick="window.location.href='sumRank.html';" class="blue-button" style="margin: 10px;">
      å­¦ç”Ÿæ€»æ’å
    </button>
    <button onclick="oneProduceRequest()" class="blue-button" style="margin: 10px;">
      ä¸€é”®ç”Ÿæˆæ‰€æœ‰æ•°æ®
    </button>
    <button onclick="clearDatabaseRequest()" class="blue-button" style="margin: 10px;">
      æ¸…é™¤æ•°æ®åº“
    </button>
    <button onclick="chooseClassroomRequest()" class="blue-button" style="margin: 10px;">
      ä¸€é”®åˆ†ç­
    </button>
    <button onclick="examRequest()" class="blue-button" style="margin: 10px;">
      ä¸€é”®è€ƒè¯•
    </button>
  </div>

  <!-- é€€å‡ºæŒ‰é’® -->
  <button onclick="window.location.href='login.html';" class="danger-button" style="display: block; margin: 0px auto;">
    é€€å‡º
  </button><br>

  <!-- æ³¨é”€è´¦æˆ·æŒ‰é’® -->
  <button id="deleteAccountBtn" class="danger-button" style="display: block; margin: 0px auto;">
    æ³¨é”€è´¦æˆ·
  </button><br>


  <div style="text-align: center; margin: 20px;">
    <h2>æœç´¢å­¦ç”Ÿæˆç»©</h2>
    <input type="text" id="searchInput" placeholder="è¯·è¾“å…¥å­¦ç”Ÿåå­—æˆ–å­¦å·" style="padding: 10px; width: 300px;">
    <button id="searchBtn" style="padding: 10px;">æœç´¢</button>
  </div>

  <div id="studentInfo" style=" margin: 20px;">
    <p style="font-size: 1em;"><strong>å­¦å·: </strong> <span id="searchStudentId"></span>&nbsp;&nbsp;
    <strong>å§“å: </strong> <span id="searchStudentName"></span>&nbsp;&nbsp;
    <strong>æ€§åˆ«: </strong> <span id="searchStudentSex"></span>&nbsp;&nbsp;
    <strong>ç­‰çº§: </strong> <span id="searchStudentLevel"></span>&nbsp;&nbsp;
    <strong>æ€»æˆç»©:</strong> <span id="searchStudentGPA"></span></p>
  </div>
  <table id="gradesTable2" border="1" style="margin: 20px auto; width: 100%; text-align: center;">
    <thead>
    <tr>
      <th>ç­çº§å·</th>
      <th>è¯¾ç¨‹åç§°</th>
      <th>å­¦åˆ†</th>
      <th>å­¦æœŸ</th>
      <th>å¹³æ—¶æˆç»©</th>
      <th>æœŸä¸­æˆç»©</th>
      <th>å®éªŒæˆç»©</th>
      <th>æœŸæœ«æˆç»©</th>
      <th>ç»¼åˆæˆç»©</th>
    </tr>
    </thead>
    <tbody>
    <!-- è¡¨æ ¼å†…å®¹ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
    </tbody>
  </table>

  <!-- æ–°å¢è¯¾ç¨‹ä¿¡æ¯è¡¨æ ¼ -->
  <br><h2 style="text-align: center;">è¯¾ç¨‹ä¿¡æ¯</h2>
  <table id="courseTable" border="1" style="margin: 20px auto; width: 100%; text-align: center;">
    <thead>
    <tr>
      <th>è¯¾ç¨‹å·</th>
      <th>è¯¾ç¨‹åç§°</th>
      <th>å­¦åˆ†</th>
      <th>éš¾åº¦</th>
      <th>é€‰ä¿®æ€»äººæ•°</th>
      <th>æ“ä½œ</th>
    </tr>
    </thead>
    <tbody>
    <!-- è¯¾ç¨‹ä¿¡æ¯è¡¨æ ¼å†…å®¹å°†ç”± JavaScript å¡«å…… -->
    </tbody>
    <tfoot>
    <tr>
      <td><input type="text" id="newCourseId" placeholder="è¯¾ç¨‹å·"></td>
      <td><input type="text" id="newCourseName" placeholder="è¯¾ç¨‹åç§°"></td>
      <td><input type="number" id="newCourseCredit" min="1" max="5" placeholder="å­¦åˆ†"></td>
      <td><input type="number" id="newCourseDifficulty" min="1" max="5" placeholder="éš¾åº¦"></td>
      <td></td>
      <td><button onclick="addCourse()" class="blue-button">å¢è®¾</button></td>
    </tr>
    </tfoot>
  </table>

  <h2 style="text-align: center;">ç­çº§ä¿¡æ¯</h2>
  <table id="classroomsTable" border="1" style="margin: 20px auto; width: 100%; text-align: center;">
    <thead>
    <tr>
      <th>ç­çº§å·</th>
      <th>ç­å</th>
      <th>è¯¾ç¨‹å·</th>
      <th>æ•™å¸ˆå·</th>
      <th>æ•™å¸ˆå</th>
      <th>å­¦æœŸ</th>
      <th>äººæ•°</th>
      <th>æ“ä½œ</th>
    </tr>
    </thead>
    <tbody id="classroomsTableBody">
    <!-- è¡¨æ ¼å†…å®¹ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
    </tbody>
    <tfoot>
    <tr>
    <td><input type="text" id="newClassroomId" style="width: 100px;" placeholder="ç­çº§å·" required></td>
    <td><input type="text" id="newClassroomName" style="width: 100px;" placeholder="ç­å" required></td>
    <td><input type="text" id="newCourseId2" style="width: 100px;" placeholder="è¯¾ç¨‹å·" required></td>
    <td><input type="text" id="newTeacherId" style="width: 100px;" placeholder="æ•™å¸ˆå·" required></td>
    <td></td>
    <td><input type="number" id="newTerm" min="1" max="8" placeholder="å­¦æœŸ" required></td>
    <td></td>
    <td><button onclick="addClassroom()" class="blue-button">å¢è®¾</button></td>
    </tr>
    </tfoot>

  </table>





</div>

<script>
  const userId = sessionStorage.getItem('BG_userId');
  console.log(userId); // åœ¨æ§åˆ¶å°æ‰“å°å‡º ID


  // å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è·å–ç”¨æˆ·å
  function fetchUserName() {
    // æ£€æŸ¥ userId æ˜¯å¦å­˜åœ¨
    if (userId) {
      // å‘èµ· GET è¯·æ±‚
      fetch(`http://localhost:8080/selManagerById/${userId}`)
              .then(response => {
                // æ£€æŸ¥å“åº”æ˜¯å¦æˆåŠŸ
                if (!response.ok) {
                  throw new Error('ç½‘ç»œå“åº”ä¸æ˜¯ OK');
                }
                return response.json();
              })
              .then(data => {
                // æ£€æŸ¥è¿”å›çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ
                if (data.code === 200) {
                  // å°†è¿”å›çš„ç”¨æˆ·åå¡«å……åˆ°æŒ‡å®šçš„ <span>
                  document.getElementById('userName').textContent = data.data.name;
                } else {
                  console.error('Error in response data:', data.message);
                }
              })
              .catch(error => {
                console.error('è·å–ç”¨æˆ·åæ—¶å‘ç”Ÿé”™è¯¯:', error);
              });
    } else {
      console.error('æœªæ‰¾åˆ° userId');
    }
  }
  fetchUserName();

  document.getElementById('deleteAccountBtn').addEventListener('click', function() {
    // ä½¿ç”¨ fetch API å‘é€ DELETE è¯·æ±‚
    if (confirm("æ‚¨ç¡®å®šè¦æ³¨é”€è´¦æˆ·å—ï¼ŸğŸ˜¢ğŸ˜¢")) {
      fetch(`http://localhost:8080/delManagerById/${userId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
              .then(response => {
                if (response.ok) {
                  // æ³¨é”€æˆåŠŸåè·³è½¬åˆ° login.html
                  window.location.href = 'login.html';
                } else {
                  // å¤„ç†é”™è¯¯
                  alert('æ³¨é”€è´¦æˆ·å¤±è´¥!');
                }
              })
              .catch(error => {
                console.error('å‡ºç°é”™è¯¯:', error);
                alert('æ³¨é”€è´¦æˆ·æ—¶å‘ç”Ÿé”™è¯¯!');
              });
    }
  });


  function formatScore(score) {
    return score === -1 ? "æœªè€ƒ" : score;
  }
  // æœç´¢å­¦ç”Ÿæ•°æ®çš„å‡½æ•°
  function fetchStudentData2(idOrName) {
    fetch(`http://localhost:8080/searchStudentGrade/${idOrName}`)
            .then(response => response.json())
            .then(data => {
              if (data.code === 200) {

                // å¡«å……å­¦ç”ŸåŸºæœ¬ä¿¡æ¯
                const student = data.data.student;
                document.getElementById("searchStudentId").textContent = student.id;
                document.getElementById("searchStudentName").textContent = student.name;
                document.getElementById("searchStudentSex").textContent = student.sex;
                document.getElementById("searchStudentLevel").textContent = student.level;
                document.getElementById("searchStudentGPA").textContent = student.gpa; // ä¿ç•™ä¸¤ä½å°æ•°

                // å¡«å……æˆç»©è¡¨
                const grades = data.data.grade;
                const tbody = document.getElementById("gradesTable2").getElementsByTagName("tbody")[0];
                tbody.innerHTML = "";  // æ¸…ç©ºåŸæœ‰è¡¨æ ¼å†…å®¹
                grades.forEach(grade => {
                  const row = tbody.insertRow();
                  row.insertCell(0).textContent = grade.classroomId;
                  row.insertCell(1).textContent = grade.courseName;
                  row.insertCell(2).textContent = grade.credit;
                  row.insertCell(3).textContent = grade.term;
                  row.insertCell(4).textContent = formatScore(grade.usualScore);
                  row.insertCell(5).textContent = formatScore(grade.middleScore);
                  row.insertCell(6).textContent = formatScore(grade.experimentScore);
                  row.insertCell(7).textContent = formatScore(grade.endScore);
                  row.insertCell(8).textContent = formatScore(grade.sumScore);
                });
              } else {
                alert('æŸ¥è¯¢å¤±è´¥: ' + data.message);
              }
            })
            .catch(error => {
              console.error('è·å–å­¦ç”Ÿæ•°æ®æ—¶å‡ºç°é”™è¯¯:', error);
              alert('è·å–å­¦ç”Ÿæ•°æ®æ—¶å‘ç”Ÿé”™è¯¯!');
            });
  }

  // æ·»åŠ æœç´¢æŒ‰é’®çš„äº‹ä»¶ç›‘å¬
  document.getElementById('searchBtn').addEventListener('click', function() {
    const searchInput = document.getElementById('searchInput').value.trim();
    if (searchInput) {
      fetchStudentData2(searchInput);  // è°ƒç”¨å‡½æ•°æœç´¢å­¦ç”Ÿ
    } else {
      alert("è¯·è¾“å…¥å­¦ç”Ÿåå­—æˆ–å­¦å·");
    }
  });

  async function oneProduceRequest() {
    try {
      const response = await fetch('http://localhost:8080/GenerateData', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({}) // å‘é€çš„è¯·æ±‚ä½“å¯ä»¥æ˜¯ç©ºå¯¹è±¡
      });
      console.log(`POSTè¯·æ±‚å·²å‘é€ï¼ŒçŠ¶æ€: ${response.status}`);
      alert('ä¸€é”®ç”Ÿæˆæ•°æ®æˆåŠŸ!');
      window.location.reload();
    } catch (error) {
      console.error('å‘é€POSTè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯:', error);
    }
  }
  async function clearDatabaseRequest() {
    try {
      const response = await fetch('http://localhost:8080/clearData', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({}) // å‘é€çš„è¯·æ±‚ä½“å¯ä»¥æ˜¯ç©ºå¯¹è±¡
      });
      console.log(`DELETEè¯·æ±‚å·²å‘é€ï¼ŒçŠ¶æ€: ${response.status}`);
      alert('æ¸…é™¤æ•°æ®åº“æˆåŠŸ!');
      window.location.reload();
    } catch (error) {
      console.error('å‘é€DELETEè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯:', error);
    }
  }
  async function chooseClassroomRequest() {
    try {
      const response = await fetch('http://localhost:8080/chooseClass', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({}) // å‘é€çš„è¯·æ±‚ä½“å¯ä»¥æ˜¯ç©ºå¯¹è±¡
      });
      console.log(`POSTè¯·æ±‚å·²å‘é€ï¼ŒçŠ¶æ€: ${response.status}`);
      alert('ä¸€é”®åˆ†ç­æˆåŠŸ!');
      window.location.reload();
    } catch (error) {
      console.error('å‘é€POSTè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯:', error);
    }
  }
  async function examRequest() {
    try {
      const response = await fetch('http://localhost:8080/generateGrade', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({}) // å‘é€çš„è¯·æ±‚ä½“å¯ä»¥æ˜¯ç©ºå¯¹è±¡
      });
      console.log(`POSTè¯·æ±‚å·²å‘é€ï¼ŒçŠ¶æ€: ${response.status}`);
      alert('ä¸€é”®è€ƒè¯•æˆåŠŸ!');
      window.location.reload();
    } catch (error) {
      console.error('å‘é€POSTè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯:', error);
    }
  }

  function fetchCourseInfo() {
    fetch('http://localhost:8080/allCourse')
            .then(response => {
              if (!response.ok) throw new Error('ç½‘ç»œå“åº”ä¸æ˜¯ OK');
              return response.json();
            })
            .then(data => {
              if (data.code === 200) {
                populateCourseTable(data.data);
              } else {
                console.error('Error in response data:', data.message);
              }
            })
            .catch(error => {
              console.error('è·å–è¯¾ç¨‹ä¿¡æ¯æ—¶å‘ç”Ÿé”™è¯¯:', error);
            });
  }

  function populateCourseTable(courses) {
    const courseTableBody = document.getElementById('courseTable').querySelector('tbody');
    courseTableBody.innerHTML = ''; // æ¸…ç©ºè¡¨ä½“

    // å¡«å……è¯¾ç¨‹æ•°æ®
    courses.forEach(course => {
      const row = `
              <tr>
                  <td>${course.id}</td>
                  <td>${course.name}</td>
                  <td>${course.credit}</td>
                  <td>${course.difficulty}</td>
                  <td>${course.numStudents}</td>
                  <td>
                      <button onclick="deleteCourse(${course.id})" class="danger-button">åˆ é™¤</button>
                  </td>
              </tr>
          `;
      courseTableBody.insertAdjacentHTML('beforeend', row);
    });
  }

  function deleteCourse(courseId) {
    if (confirm("æ‚¨ç¡®å®šè¦åˆ é™¤è¿™é—¨è¯¾ç¨‹å—ï¼Ÿ")) {
      fetch(`http://localhost:8080/delCourseById/${courseId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
              .then(response => {
                if (response.ok) {
                  fetchCourseInfo(); // é‡æ–°è·å–è¯¾ç¨‹ä¿¡æ¯
                  fetchClassRooms(); // é‡æ–°è·å–ç­çº§ä¿¡æ¯
                } else {
                  alert('åˆ é™¤è¯¾ç¨‹å¤±è´¥!');
                }
              })
              .catch(error => {
                console.error('åˆ é™¤è¯¾ç¨‹æ—¶å‡ºç°é”™è¯¯:', error);
                alert('åˆ é™¤è¯¾ç¨‹æ—¶å‡ºç°é”™è¯¯!');
              });
    }

  }

  function addCourse() {
    const id = document.getElementById('newCourseId').value;
    const name = document.getElementById('newCourseName').value;
    const credit = document.getElementById('newCourseCredit').value;
    const difficulty = document.getElementById('newCourseDifficulty').value;

    if (!id || !name || !credit || !difficulty) {
      alert('è¯·å¡«å†™æ‰€æœ‰è¯¾ç¨‹ä¿¡æ¯!');
      return;
    }

    const newCourse = {
      id: id,
      name: name,
      credit: parseInt(credit),
      difficulty: parseInt(difficulty)
    };

    fetch('http://localhost:8080/addCourse', {
      method: 'POST',
      body: new URLSearchParams(newCourse)
    })
            .then(response => {
              if (response.ok) {
                fetchCourseInfo(); // é‡æ–°åŠ è½½è¯¾ç¨‹ä¿¡æ¯
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('newCourseId').value = '';
                document.getElementById('newCourseName').value = '';
                document.getElementById('newCourseCredit').value = '';
                document.getElementById('newCourseDifficulty').value = '';
              } else {
                alert('æ·»åŠ è¯¾ç¨‹å¤±è´¥!');
              }
            })
            .catch(error => {
              console.error('æ·»åŠ è¯¾ç¨‹æ—¶å‡ºç°é”™è¯¯:', error);
              alert('æ·»åŠ è¯¾ç¨‹æ—¶å‡ºç°é”™è¯¯!');
            });
  }
  fetchCourseInfo();

  // è·å–æ‰€æœ‰ç­çº§ä¿¡æ¯å¹¶å¡«å……è¡¨æ ¼
  function fetchClassRooms() {
    fetch('http://localhost:8080/allClassroom')
            .then(response => response.json())
            .then(data => {
              if (data.code === 200) {
                const tableBody = document.getElementById('classroomsTableBody');
                tableBody.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
                data.data.forEach(classroom => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                                <td>${classroom.id}</td>
                                <td>${classroom.name}</td>
                                <td>${classroom.courseId}</td>
                                <td>${classroom.teacherId}</td>
                                <td>${classroom.teacherName}</td>
                                <td>${classroom.term}</td>
                                <td>${classroom.numStudent}</td>
                                <td><button onclick="deleteClassroom(${classroom.id})" class="danger-button">åˆ é™¤</button></td>
                            `;
                  tableBody.appendChild(row);
                });
              } else {
                alert("è·å–ç­çº§ä¿¡æ¯å¤±è´¥ï¼");
              }
            })
            .catch(error => console.error('Error fetching classrooms:', error));
  }

  // åˆ é™¤ç­çº§
  function deleteClassroom(id) {
    fetch(`http://localhost:8080/delClassroomById/${id}`, {
      method: 'DELETE'
    })
            .then(response => response.json())
            .then(data => {
              if (data.code === 200) {
                alert("ç­çº§å·²åˆ é™¤ï¼");
                fetchCourseInfo(); // é‡æ–°è·å–è¯¾ç¨‹ä¿¡æ¯
                fetchClassRooms(); // é‡æ–°è·å–ç­çº§ä¿¡æ¯
              } else {
                alert("åˆ é™¤ç­çº§å¤±è´¥ï¼");
              }
            })
            .catch(error => console.error('Error deleting classroom:', error));
  }

  // å¢è®¾ç­çº§
  function addClassroom() {
    const id = document.getElementById('newClassroomId').value;
    const name = document.getElementById('newClassroomName').value;
    const courseId = document.getElementById('newCourseId2').value;
    const teacherId = document.getElementById('newTeacherId').value;
    // const teacherName = document.getElementById('newTeacherName').value;
    const term = document.getElementById('newTerm').value; // è·å–å­¦æœŸ
    // const numStudent = document.getElementById('newNumStudent').value; // è·å–äººæ•°

    const formData = new URLSearchParams();
    formData.append('id', id);
    formData.append('name', name);
    formData.append('courseId', courseId);
    formData.append('teacherId', teacherId);
    // formData.append('teacherName', teacherName);
    formData.append('term', term);
    // formData.append('numStudent', numStudent); // æ·»åŠ äººæ•°

    fetch('http://localhost:8080/addClassroom', {
      method: 'POST',
      body: formData,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      }
    })
            .then(response => response.json())
            .then(data => {
              if (data.code === 200) {
                alert("ç­çº§å·²å¢åŠ ï¼");
                fetchClassRooms(); // é‡æ–°è·å–ç­çº§ä¿¡æ¯
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('newClassroomId').value = '';
                document.getElementById('newClassroomName').value = '';
                document.getElementById('newCourseId').value = '';
                document.getElementById('newTeacherId').value = '';
                document.getElementById('newTeacherName').value = '';
                document.getElementById('newTerm').value = '';
                document.getElementById('newNumStudent').value = '';
              } else {
                alert("å¢åŠ ç­çº§å¤±è´¥ï¼");
              }
            })
            .catch(error => console.error('Error adding classroom:', error));
  }
  fetchClassRooms();


</script>
</body>
</html>